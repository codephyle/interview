// The "beck" exploit. In the Apache 1.2 web server,
// there is a function called no2slash whose purpose is to collapse multiple '/'s.
// For example /d1///d2////d3/test.html becomes /d1/d2/d3/test.html.
// The original algorithm was to repeatedly search for a '/' and copy the remainder of the string over.
void no2slash(char *name)
{
   int x, y;
   for (x = 0; name[x];)
      if (x && (name[x - 1] == '/') && (name[x] == '/'))
         for (y = x + 1; name[y - 1]; y++)
            name[y - 1] = name[y];
      else
         x++;
}

// Unfortunately, it's running time is quadratic in the number of '/'s in the input.
// By sending multiple simultaneous requests with large numbers of '/'s, you can deluge a server and
// starve other processes for CPU time, thereby creating a denial of service attack.
// Fix the version of no2slash so that it runs in linear time and does not allow for the above attack.

//  offset = 0
//  for i = 2 to n do
//     if a[i-1] = '/' and a[i] = '/' then
//        offset = offset + 1
//     else
//        a[i-offset] = a[i]
//  end for

void no2slash(char *name)
{
   char *d, *s;
   s = d = name;
   while (*s)
   {
      if ((*d++ = *s) == '/')
      {
         do
         {
            ++s;
         } while (*s == '/');
      }
      else
      {
         ++s;
      }
   }
   *d = '\0';
}
